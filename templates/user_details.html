{% extends "base.html" %}

{% block title %}{{ user.fname }} {{ user.lname }}{% endblock %}

{% block content %}
<div class="row game-reviews">
    {% if user.reviews %}
        {% if num_pages > 1 %}
            <h2 class="paginated-header"></h2>
            <div class="col-lg-4 col-md-6 col-xs-12 paginated-reviews"></div>
            {% for index in range(1, num_pages + 1) %}
                <a class="pagination" id="{{ index }}" href="/users/{{ user.user_id }}">{{ index }}</a>
            {% endfor %}
        {% else %}
            <h2>Reviews</h2>
            {% for review in reviews %}
                <div class="col-lg-4 col-md-6 col-xs-12">
                    <h4><a href="/games/{{ review.game.game_id }}">{{ review.user.username }}</a></h4>
                    <strong>{{ review.score }}</strong>
                    {% if review.comment %}
                        <p>{{ review.comment }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    {% endif %}
</div>

<script type="text/javascript">
    var userId = "{{ user.user_id }}";
    var paginatedReviews = $("div.paginated-reviews");

    var urlIndex = 1;

    var getReviews = function (){
        var maxReview = urlIndex * 10;
        var data = {"userId": userId, "maxReview": maxReview};

        $.get("/get_user_reviews.json", data, setPaginatedReviews);
    };

    var setPaginatedReviews = function (results) {
        paginatedHTML = "";
        for (var i = 0; i < results.length; i++){
            console.log(results[i]["username"])
            paginatedHTML = (paginatedHTML + "<div class='col-lg-4 col-md-6 col-xs-12'><h4><a href='/games/" + results[i]['game_id'] + "'>" +
                results[i]['name'] + "</a></h4><strong>" + results[i]['score'] + "</strong>");
            if (results[i]["comment"]){
                paginatedHTML = paginatedHTML + "<p>" + results[i]["comment"] + "</p>";
            }
            paginatedHTML = paginatedHTML + "</div>";
        }
        paginatedReviews.html(paginatedHTML);
    };

    $("a.pagination").on("click", function (evt) {
        evt.preventDefault();
        var index = $(this).attr("id");
        urlIndex = parseInt(index) ;
        getReviews();
    });

    $(document).ready(getReviews());
</script>
{% endblock %}